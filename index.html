<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Background Effects Gallery</title>
<style>
  :root{
    --bg:#000;
    --fg:#eaeaea;
    --accent:#9900FF;
    --panel:#0b0b0b;
    --panel-glass: rgba(255,255,255,.06);
    --border: rgba(255,255,255,.15);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",Helvetica,Arial,sans-serif;overflow:hidden;}
  canvas{position:fixed;inset:0;width:100%;height:100%;display:block}
  .legend{
    position:fixed;left:14px;top:14px;z-index:10;
    background:var(--panel-glass);backdrop-filter:blur(8px);
    border:1px solid var(--border);border-radius:14px;padding:10px 12px;max-width:min(92vw,460px);
    box-shadow:0 12px 32px rgba(0,0,0,.35);font-weight:700
  }
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .chip{
    display:flex;align-items:center;gap:8px;border:1px solid var(--border);
    padding:6px 10px;border-radius:999px;background:#00000033;cursor:pointer;user-select:none
  }
  .dot{width:12px;height:12px;border-radius:50%}
  .chip.active{outline:2px solid var(--accent);box-shadow:0 0 0 3px #ffffff10}
  .title{font-size:12px;opacity:.85}
  .controls{margin-top:8px;font-size:12px;opacity:.7}
  .status{margin-top:8px;font-size:12px}
  .accent{color:var(--accent)}
</style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="legend" id="legend">
  <div class="title">Background Effects <span class="accent" id="effectName">Starfield</span></div>
  <div class="row" id="chips"></div>
  <div class="status">Auto-rotate: <span id="autoState">ON</span> • Every <span id="intervalMs">8,000</span> ms</div>
  <div class="controls">Controls: <b>Space/→</b> next, <b>←</b> prev, <b>A</b> auto, <b>R</b> random</div>
</div>

<script>
(function(){
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  let W, H, t = 0, raf;
  function resize(){
    W = canvas.width = Math.floor(innerWidth * DPR);
    H = canvas.height = Math.floor(innerHeight * DPR);
    canvas.style.width = innerWidth + 'px';
    canvas.style.height = innerHeight + 'px';
  }
  resize(); addEventListener('resize', resize);

  // ---------- Effect registry ----------
  // Each effect: { name, color, init(ctx), frame(ctx, dt, t), cleanup() }
  const effects = [];

  // Helpers
  const R = (a,b)=> a + Math.random()*(b-a);
  const clamp = (x,a,b)=> Math.max(a, Math.min(b,x));

  // 1) Starfield (accent: violet)
  effects.push({
    name:'Starfield',
    color:'#9900FF',
    init(){
      this.ps = Array.from({length:160}, _=>({
        x:R(0,W), y:R(0,H), z:R(.2,1.2), vx:R(-.2,.2), vy:R(-.2,.2), r:R(.6,1.8), a:R(.35,.95)
      }));
      this.mx = W/2; this.my = H/2;
      this.mm = (e)=>{ this.mx = (e.clientX||innerWidth/2)*DPR; this.my = (e.clientY||innerHeight/2)*DPR; };
      addEventListener('pointermove', this.mm);
    },
    frame(){
      ctx.clearRect(0,0,W,H);
      for (const p of this.ps){
        const dx=(this.mx-p.x)*0.0006, dy=(this.my-p.y)*0.0006;
        p.vx=(p.vx+dx)*0.985; p.vy=(p.vy+dy)*0.985;
        p.x+=p.vx + p.z*0.2; p.y+=p.vy + p.z*0.2;
        if(p.x<-10||p.x>W+10||p.y<-10||p.y>H+10){ p.x=R(0,W); p.y=R(0,H); p.vx=R(-.2,.2); p.vy=R(-.2,.2); }
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle=`rgba(153,0,255,${p.a})`; ctx.fill();
      }
    },
    cleanup(){ removeEventListener('pointermove', this.mm); }
  });

  // 2) Matrix Rain (accent: neon green)
  effects.push({
    name:'Matrix Rain',
    color:'#00FF88',
    init(){
      this.cols = Math.ceil(W/(14*DPR));
      this.y = Array(this.cols).fill(0);
      this.chars = 'アカサタナハマヤラワ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    },
    frame(){
      ctx.fillStyle = 'rgba(0,0,0,0.08)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle = this.color; ctx.font = `${14*DPR}px monospace`;
      for(let i=0;i<this.cols;i++){
        const ch = this.chars[Math.floor(Math.random()*this.chars.length)];
        ctx.fillText(ch, i*14*DPR, this.y[i]*16*DPR);
        this.y[i] = (this.y[i]*16*DPR > H && Math.random() > 0.975) ? 0 : this.y[i]+1;
      }
    },
    cleanup(){}
  });

  // 3) Aurora Waves (accent: teal)
  effects.push({
    name:'Aurora Waves',
    color:'#00E5FF',
    init(){},
    frame(_,dt,tt){
      ctx.clearRect(0,0,W,H);
      ctx.globalCompositeOperation='lighter';
      for(let k=0;k<3;k++){
        const grad = ctx.createLinearGradient(0,0,W,H);
        const hue = ( (tt*0.03 + k*0.33)%1 ) * 360;
        grad.addColorStop(0, `hsla(${hue},100%,60%,0.08)`);
        grad.addColorStop(1, `hsla(${(hue+120)%360},100%,60%,0.08)`);
        ctx.fillStyle = grad;
        const y = H*0.3 + Math.sin(tt*0.002 + k)*H*0.1;
        ctx.beginPath();
        ctx.moveTo(0, y);
        for(let x=0;x<=W;x+=20){
          const yy = y + Math.sin(x*0.01 + tt*0.002 + k)*40*DPR;
          ctx.lineTo(x, yy);
        }
        ctx.lineTo(W,H); ctx.lineTo(0,H); ctx.closePath();
        ctx.fill();
      }
      ctx.globalCompositeOperation='source-over';
    },
    cleanup(){}
  });

  // 4) Plasma Bands (accent: orange)
  effects.push({
    name:'Plasma Bands',
    color:'#FFA500',
    init(){},
    frame(_,dt,tt){
      ctx.clearRect(0,0,W,H);
      for(let i=0;i<8;i++){
        const off = tt*0.001 + i*0.4;
        const grad = ctx.createRadialGradient(
          W*(0.5+0.35*Math.sin(off)), H*(0.5+0.35*Math.cos(off)), 10,
          W*(0.5+0.35*Math.cos(off*0.7)), H*(0.5+0.35*Math.sin(off*0.8)), Math.max(W,H)
        );
        grad.addColorStop(0, `hsla(${(off*180)%360},100%,55%,0.10)`);
        grad.addColorStop(1, `hsla(${(off*180+120)%360},100%,55%,0.02)`);
        ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);
      }
    },
    cleanup(){}
  });

  // 5) Metaballs (accent: cyan)
  effects.push({
    name:'Metaballs',
    color:'#00FFFF',
    init(){
      const n=10; this.b=[];
      for(let i=0;i<n;i++){
        this.b.push({
          x:R(0,W), y:R(0,H), r:R(20*DPR, 80*DPR),
          vx:R(-1,1), vy:R(-1,1),
          c:`hsla(${R(180,220)},100%,60%,0.4)`
        });
      }
    },
    frame(){
      ctx.clearRect(0,0,W,H);
      ctx.globalCompositeOperation='lighter';
      for(const m of this.b){
        m.x+=m.vx; m.y+=m.vy;
        if(m.x<m.r||m.x>W-m.r) m.vx*=-1;
        if(m.y<m.r||m.y>H-m.r) m.vy*=-1;
        const g = ctx.createRadialGradient(m.x,m.y,1,m.x,m.y,m.r);
        g.addColorStop(0,m.c); g.addColorStop(1,'rgba(0,0,0,0)');
        ctx.fillStyle=g; ctx.beginPath(); ctx.arc(m.x,m.y,m.r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalCompositeOperation='source-over';
    },
    cleanup(){}
  });

  // 6) Confetti (accent: yellow)
  effects.push({
    name:'Confetti',
    color:'#FFD166',
    init(){
      this.items = Array.from({length:180}, _=>({
        x:R(0,W), y:R(-H,0), s:R(4*DPR,10*DPR), vy:R(0.5,2.2),
        rot:R(0,Math.PI*2), vr:R(-0.05,0.05),
        c:`hsl(${Math.floor(R(0,360))},100%,60%)`
      }));
    },
    frame(){
      ctx.clearRect(0,0,W,H);
      for(const p of this.items){
        p.y += p.vy; p.rot += p.vr; if(p.y>H+20) { p.y = -20; p.x=R(0,W); }
        ctx.save();
        ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.fillStyle = p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);
        ctx.restore();
      }
    },
    cleanup(){}
  });

  // 7) Hex Pulse (accent: blue)
  effects.push({
    name:'Hex Pulse',
    color:'#4DA3FF',
    init(){ this.t = 0; },
    frame(_,dt,tt){
      ctx.clearRect(0,0,W,H);
      const size = 28*DPR;
      const w = Math.ceil(W/(size*1.5))+2;
      const h = Math.ceil(H/(size*Math.sqrt(3)))+2;
      for(let j=0;j<h;j++){
        for(let i=0;i<w;i++){
          const x = i*size*1.5 + (j%2? size*0.75: 0);
          const y = j*size*Math.sqrt(3)/2;
          const puls = (Math.sin((x+y)*0.01 + tt*0.003)+1)/2; // 0..1
          const c = `hsla(${200+60*puls},100%,${40+20*puls}%,${0.25+0.15*puls})`;
          drawHex(x,y,size*0.9,c);
        }
      }
      function drawHex(cx,cy,r,fill){
        ctx.beginPath();
        for(let k=0;k<6;k++){
          const a = Math.PI/3*k;
          const px = cx + r*Math.cos(a);
          const py = cy + r*Math.sin(a);
          k? ctx.lineTo(px,py): ctx.moveTo(px,py);
        }
        ctx.closePath();
        ctx.fillStyle = fill; ctx.fill();
      }
    },
    cleanup(){}
  });

  // 8) Low-Poly Triangles (accent: pink)
  effects.push({
    name:'Low-Poly Triangles',
    color:'#FF66CC',
    init(){
      this.pts = [];
      const step = 90 * DPR;
      for(let y=0;y<=H;y+=step){
        for(let x=0;x<=W;x+=step){
          this.pts.push({x:x+R(-25,25), y:y+R(-25,25)});
        }
      }
      this.tris = [];
      const cols = Math.floor(W/step)+1;
      const rows = Math.floor(H/step)+1;
      for(let j=0;j<rows-1;j++){
        for(let i=0;i<cols-1;i++){
          const p0 = j*cols + i;
          const p1 = p0+1;
          const p2 = p0+cols;
          const p3 = p2+1;
          this.tris.push([p0,p2,p1]);
          this.tris.push([p1,p2,p3]);
        }
      }
    },
    frame(_,dt,tt){
      ctx.clearRect(0,0,W,H);
      for(const tri of this.tris){
        const p = tri.map(idx=>this.pts[idx]);
        const hue = ( (p[0].x + p[0].y + tt*0.05) % 720 ) / 2;
        ctx.beginPath(); ctx.moveTo(p[0].x,p[0].y);
        ctx.lineTo(p[1].x,p[1].y); ctx.lineTo(p[2].x,p[2].y); ctx.closePath();
        ctx.fillStyle = `hsla(${hue}, 80%, 40%, 0.35)`; ctx.fill();
        // gentle jitter
        for(const q of p){ q.x += Math.sin((q.x+tt)*0.0007)*0.15; q.y += Math.cos((q.y-tt)*0.0007)*0.15; }
      }
    },
    cleanup(){}
  });

  // ---------- Engine ----------
  let idx = 0, last = performance.now(), auto = true, interval = 8000, autoTimer = null;

  function setAccent(hex){
    document.documentElement.style.setProperty('--accent', hex);
  }

  function start(i){
    if (i<0) i = effects.length-1;
    if (i>=effects.length) i = 0;
    if (effects[idx] && effects[idx].cleanup) effects[idx].cleanup();
    idx = i;
    setAccent(effects[idx].color);
    document.getElementById('effectName').textContent = effects[idx].name;
    renderChips();
    effects[idx].init && effects[idx].init(ctx);
    last = performance.now();
    if (auto){
      clearTimeout(autoTimer);
      autoTimer = setTimeout(()=>start(idx+1), interval);
    }
  }

  function loop(now){
    const dt = now - last; last = now; t += dt;
    effects[idx].frame && effects[idx].frame(ctx, dt, t);
    raf = requestAnimationFrame(loop);
  }

  // ---------- UI ----------
  const chipsWrap = document.getElementById('chips');
  function renderChips(){
    chipsWrap.innerHTML = '';
    effects.forEach((e, i)=>{
      const chip = document.createElement('div');
      chip.className = 'chip' + (i===idx?' active':'');
      chip.innerHTML = `<span class="dot" style="background:${e.color}"></span><span>${e.name}</span>`;
      chip.onclick = ()=> start(i);
      chipsWrap.appendChild(chip);
    });
    document.getElementById('autoState').textContent = auto ? 'ON' : 'OFF';
    document.getElementById('intervalMs').textContent = interval.toLocaleString();
  }

  addEventListener('keydown', (e)=>{
    if (e.key === ' ' || e.key === 'ArrowRight'){ e.preventDefault(); start(idx+1); }
    else if (e.key === 'ArrowLeft'){ start(idx-1); }
    else if (e.key.toLowerCase() === 'a'){ auto = !auto; renderChips(); if (auto){ start(idx); } else { clearTimeout(autoTimer); } }
    else if (e.key.toLowerCase() === 'r'){ start(Math.floor(Math.random()*effects.length)); }
  });

  // Fire it up
  start(0);
  raf = requestAnimationFrame(loop);
})();
</script>
</body>
</html>
